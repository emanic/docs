// WE PULL THIS CONTENT FROM https://github.com/aporeto-inc/junon
// DO NOT EDIT THIS FILE.
// YOU MUST SUBMIT A PR AGAINST THE UPSTREAM REPO.
// THE UPSTREAM REPO IS CURRENTLY PRIVATE.

== Defender

=== Data collection

For advanced troubleshooting of Defender, `apoctl` provides the ability
to collect various types of information from defenders. The collected
information will be bundled and downloaded, after which time it can be
unpacked and decoded. Finally, it may be analyzed and aid in root cause
analysis.

....
apoctl defender collect <information> <defender-id>
....

Replace `<information>` with any of the following.

* `logs`
* `counters`
* `packets`
* `pustate`
* `pcap`
* `coredump`

==== logs

....
apoctl defender collect logs <defender-id>
....

This will download the given Defender’s logs and other related data.

==== counters

....
apoctl defender collect counters <defender-id>
....

This will download the error counters for the given Defender.

==== packets

....
apoctl defender collect packets <defender-id>
....

This will download selective packets logged by the given Defender.

==== pustate

....
apoctl defender collect pustate <defender-id>
....

This will download processing unit internal state for each of the given
Defender’s processing units.

==== pcap

....
apoctl defender collect pcap <defender-id> [--puid <processing-unit-id>] [--filter <expr>]
....

This will trigger and then download a `tcpdump` packet capture on the
given Defender. If given a `puid`, it will capture only traffic
associated with that processing unit. You may also give an optional
tcpdump `filter` expression.

==== coredump

....
apoctl defender collect coredump <defender-id> [--puid <processing-unit-id>]
....

This will trigger and then download a core dump file for the given
Defender. If given a `puid`, the core dump will be of the associated
remote Defender.

=== Download

The following `download` command allows you to retrieve the last bundle
collected from the given Defender.

....
apoctl defender download <defender-id>
....

=== Viewing the data

`apoctl` returns an encoded GZIP file. Use the `enforcerbundle` tool to
uncompress and decode the contents.

....
enforcerbundle --in <bundle.tar.gz> --out <output-folder>
....

The output folder will contain the requested information in viewable
form.
