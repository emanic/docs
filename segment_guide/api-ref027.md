## policy/networking

### Claims

Represents the claims in the token used to access a service.

#### Example

```json
{
  "content": {
    "exp": 1553899021,
    "iat": 1553888221,
    "iss": "https://accounts.acme.com",
    "sub": "alice@acme.com"
  },
  "hash": "1134423925458173049"
}
```

#### Relations

##### `GET /claims`

Retrieves the list of claims.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.

##### `POST /claims`

Creates a new claims record.

##### `GET /claims/:id`

Retrieves the object with the given ID.

#### Attributes

##### `ID` `string` [`identifier`,`autogenerated`,`read_only`]

Identifier of the object.

##### `content` `map[string]string` [`creation_only`]

Contains the raw JSON web token (JWT) claims.

##### `hash` `string` [`required`]

XXH64 hash of the claims content. It will be used as ID. To compute a correct
hash,
you must first clob `content` as an string array in the form `key=value`, sort
it
then apply the XXH64 function.

##### `namespace` `string` [`autogenerated`,`read_only`]

Namespace tag attached to an entity.

### ExternalNetwork

An external network represents a random network or IP address that is not
managed by Aporeto. External networks can be used in network policies to
allow traffic from or to the declared network or IP, using the provided
protocol and port (or range of ports). If you want to describe the internet
(i.e., anywhere), use `0.0.0.0/0` as the address and `1-65000` for the ports.
You must assign the external network one or more tags. These allow you to
reference the external network from your network policies.

#### Example

```json
{
  "name": "the name",
  "propagate": false,
  "protected": false,
  "type": "Subnet"
}
```

#### Relations

##### `GET /externalnetworks`

Retrieves the list of external networks.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.
- `archived` (`boolean`): Also retrieve the objects that have been archived.
- `propagated` (`boolean`): Also retrieve the objects that propagate down.

##### `POST /externalnetworks`

Creates a new external network.

##### `DELETE /externalnetworks/:id`

Deletes the object with the given ID.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.

##### `GET /externalnetworks/:id`

Retrieves the object with the given ID.

Parameters:

- `archived` (`boolean`): Also retrieve the objects that have been archived.
- `propagated` (`boolean`): Also retrieve the objects that propagate down.

##### `PUT /externalnetworks/:id`

Updates the object with the given ID.

##### `GET /infrastructurepolicies/:id/externalnetworks`

Returns the list of external networks affected by an infrastructure policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

##### `GET /networkaccesspolicies/:id/externalnetworks`

Returns the list of external networks affected by a network policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

#### Attributes

##### `ID` `string` [`identifier`,`autogenerated`,`read_only`]

Identifier of the object.

##### `annotations` `map[string][]string`

Stores additional information about an entity.

##### `associatedTags` `[]string`

List of tags attached to an entity.

##### `createTime` `time` [`autogenerated`,`read_only`]

Creation date of the object.

##### `description` `string` [`max_length=1024`]

Description of the object.

##### `entries` `[]string`

List of CIDRs or domain name.

##### `metadata` `[]string` [`creation_only`]

Contains tags that can only be set during creation, must all start
with the '@' prefix, and should only be used by external systems.

##### `name` `string` [`required`,`max_length=256`]

Name of the entity.

##### `namespace` `string` [`autogenerated`,`read_only`]

Namespace tag attached to an entity.

##### `normalizedTags` `[]string` [`autogenerated`,`read_only`]

Contains the list of normalized tags of the entities.

##### `ports` `[]string`

_This attribute is deprecated_.

List of single ports or range (xx:yy).

##### `propagate` `boolean`

Propagates the policy to all of its children.

##### `protected` `boolean`

Defines if the object is protected.

##### `protocols` `[]string`

_This attribute is deprecated_.

List of protocols (`tcp`, `udp`, or protocol number).

##### `servicePorts` `[]string`

List of protocol/ports `(tcp/80)` or `(udp/80:100)`.

##### `type` `enum(ENI | RDSCluster | RDSInstance | SecurityGroup | Subnet)`

The type of external network (default `Subnet`).

Default value:

```json
"Subnet"
```

##### `updateTime` `time` [`autogenerated`,`read_only`]

Last update date of the object.

### FlowReport

Post a new flow log.

#### Example

```json
{
  "action": "Accept",
  "destinationController": "api.east.acme.com",
  "destinationID": "xxx-xxx-xxx",
  "destinationNamespace": "/my/namespace",
  "destinationType": "ProcessingUnit",
  "encrypted": false,
  "namespace": "/my/namespace",
  "observed": false,
  "observedAction": "NotApplicable",
  "observedEncrypted": false,
  "observedPolicyID": "xxx-xxx-xxx",
  "observedPolicyNamespace": "/my/namespace",
  "policyID": "xxx-xxx-xxx",
  "policyNamespace": "/my/namespace",
  "protocol": 6,
  "serviceType": "NotApplicable",
  "sourceController": "api.west.acme.com",
  "sourceID": "xxx-xxx-xxx",
  "sourceNamespace": "/my/namespace",
  "sourceType": "ProcessingUnit",
  "value": 1
}
```

#### Relations

##### `POST /flowreports`

Create a flow statistics report.

#### Attributes

##### `action` `enum(Accept | Reject)` [`required`]

Action applied to the flow.

##### `destinationController` `string`

Identifier of the destination controller.

##### `destinationID` `string` [`required`]

ID of the destination.

##### `destinationIP` `string`

Destination IP address.

##### `destinationNamespace` `string`

_This attribute is deprecated_.

Namespace of the destination. This is deprecated. Use `remoteNamespace`. This
property does nothing.

##### `destinationPort` `integer`

Port of the destination.

##### `destinationType` `enum(ProcessingUnit | ExternalNetwork | Claims)` [`required`]

Destination type.

##### `dropReason` `string`

This field is only set if `action` is set to `Reject`. It specifies the reason
for the rejection.

##### `encrypted` `boolean`

If `true`, the flow was encrypted.

##### `namespace` `string` [`required`]

_This attribute is deprecated_.

This is here for backward compatibility.

##### `observed` `boolean`

If `true`, design mode is on.

##### `observedAction` `enum(Accept | Reject | NotApplicable)`

Action observed on the flow.

Default value:

```json
"NotApplicable"
```

##### `observedDropReason` `string`

Specifies the reason for a rejection. Only set if `observedAction` is set
to `Reject`.

##### `observedEncrypted` `boolean`

Value of the encryption of the network policy that observed the flow.

##### `observedPolicyID` `string`

ID of the network policy that observed the flow.

##### `observedPolicyNamespace` `string`

Namespace of the network policy that observed the flow.

##### `policyID` `string` [`required`]

ID of the network policy that accepted the flow.

##### `policyNamespace` `string` [`required`]

Namespace of the network policy that accepted the flow.

##### `protocol` `integer` [`required`]

Protocol number.

##### `remoteNamespace` `string`

Namespace of the object at the other end of the flow.

##### `serviceClaimHash` `string`

Hash of the claims used to communicate.

##### `serviceID` `string`

ID of the service.

##### `serviceNamespace` `string`

Namespace of Service accessed.

##### `serviceType` `enum(L3 | HTTP | TCP | NotApplicable)`

ID of the service.

Default value:

```json
"NotApplicable"
```

##### `serviceURL` `string`

Service URL accessed.

##### `sourceController` `string`

Identifier of the source controller.

##### `sourceID` `string` [`required`]

ID of the source.

##### `sourceIP` `string`

Type of the source.

##### `sourceNamespace` `string`

_This attribute is deprecated_.

Namespace of the source. This is deprecated. Use `remoteNamespace`. This
property does nothing.

##### `sourceType` `enum(ProcessingUnit | ExternalNetwork | Claims)` [`required`]

Type of the source.

##### `timestamp` `time`

Time and date of the log.

##### `value` `integer` [`required`]

Number of flows in the log.

### InfrastructurePolicy

Infrastructure policies represent the network access rules of the underlying
infrastructure. They can assist you in analyzing how AWS security groups,
firewalls,
and other access control list (ACL) mechanisms may affect Aporeto network
policies.
Aporeto's AWS integration app automatically populates AWS security groups.

#### Example

```json
{
  "action": "Allow",
  "applyPolicyMode": "OutgoingTraffic",
  "disabled": false,
  "name": "the name",
  "protected": false
}
```

#### Relations

##### `GET /infrastructurepolicies`

Retrieves the list of infrastructure policies.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.

##### `POST /infrastructurepolicies`

Creates a new infrastructure policy.

##### `DELETE /infrastructurepolicies/:id`

Deletes the infrastructure policy with the given ID.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.

##### `GET /infrastructurepolicies/:id`

Retrieves the infrastructure policy with the given ID.

##### `PUT /infrastructurepolicies/:id`

Updates the infrastructure policy with the given ID.

##### `GET /infrastructurepolicies/:id/externalnetworks`

Returns the list of external networks affected by an infrastructure policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

##### `GET /infrastructurepolicies/:id/processingunits`

Returns the list of processing units affected by an infrastructure policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

##### `GET /infrastructurepolicies/:id/services`

Returns the list of services affected by an infrastructure policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

#### Attributes

##### `ID` `string` [`identifier`,`autogenerated`,`read_only`]

Identifier of the object.

##### `action` `enum(Allow | Reject)`

Defines the action to apply to a flow.

Default value:

```json
"Allow"
```

##### `activeDuration` `string` [`format=^[0-9]+[smh]$`]

Defines for how long the policy will be active according to the
`activeSchedule`.

##### `activeSchedule` `string`

Defines when the policy should be active using the cron notation.
The policy will be active for the given `activeDuration`.

##### `annotations` `map[string][]string`

Stores additional information about an entity.

##### `applyPolicyMode` `enum(OutgoingTraffic | IncomingTraffic)`

Determines if the policy applies to the outgoing traffic of the `subject` or the
incoming traffic of the `subject`. `OutgoingTraffic` (default) or
`IncomingTraffic`.

Default value:

```json
"OutgoingTraffic"
```

##### `associatedTags` `[]string`

List of tags attached to an entity.

##### `createTime` `time` [`autogenerated`,`read_only`]

Creation date of the object.

##### `description` `string` [`max_length=1024`]

Description of the object.

##### `disabled` `boolean`

Defines if the property is disabled.

##### `expirationTime` `time`

If set the policy will be automatically deleted after the given time.

##### `metadata` `[]string` [`creation_only`]

Contains tags that can only be set during creation, must all start
with the '@' prefix, and should only be used by external systems.

##### `name` `string` [`required`,`max_length=256`]

Name of the entity.

##### `namespace` `string` [`autogenerated`,`read_only`]

Namespace tag attached to an entity.

##### `normalizedTags` `[]string` [`autogenerated`,`read_only`]

Contains the list of normalized tags of the entities.

##### `object` `[][]string`

Object of the policy.

##### `protected` `boolean`

Defines if the object is protected.

##### `subject` `[][]string`

Subject of the policy.

##### `updateTime` `time` [`autogenerated`,`read_only`]

Last update date of the object.

### NetworkAccessPolicy

Allows you to define network policies to allow or prevent processing units
identified by their tags to talk to other processing units or external networks
(also identified by their tags).

#### Example

```json
{
  "action": "Allow",
  "applyPolicyMode": "Bidirectional",
  "disabled": false,
  "encryptionEnabled": false,
  "fallback": false,
  "logsEnabled": false,
  "name": "the name",
  "negateObject": false,
  "negateSubject": false,
  "observationEnabled": false,
  "observedTrafficAction": "Continue",
  "propagate": false,
  "protected": false
}
```

#### Relations

##### `GET /networkaccesspolicies`

Retrieves the list of network policies.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.
- `propagated` (`boolean`): Also retrieve the objects that propagate down.

##### `POST /networkaccesspolicies`

Creates a new network policy.

##### `DELETE /networkaccesspolicies/:id`

Deletes the policy with the given ID.

Parameters:

- `q` (`string`): Filtering query. Consequent `q` parameters will form an or.

##### `GET /networkaccesspolicies/:id`

Retrieves the policy with the given ID.

Parameters:

- `propagated` (`boolean`): Also retrieve the objects that propagate down.

##### `PUT /networkaccesspolicies/:id`

Updates the policy with the given ID.

##### `GET /networkaccesspolicies/:id/externalnetworks`

Returns the list of external networks affected by a network policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

##### `GET /networkaccesspolicies/:id/processingunits`

Returns the list of processing units affected by a network policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

##### `GET /networkaccesspolicies/:id/services`

Returns the list of services affected by a network policy.

Parameters:

- `mode` (`enum(subject | object)`): Matching mode.

#### Attributes

##### `ID` `string` [`identifier`,`autogenerated`,`read_only`]

Identifier of the object.

##### `action` `enum(Allow | Reject | Continue)`

Defines the action to apply to a flow.

- `Allow`: allows the defined traffic.
- `Reject`: rejects the defined traffic; useful in conjunction with an allow all
policy.
- `Continue`: neither allows or rejects the traffic; useful for applying another
property to the traffic.

Default value:

```json
"Allow"
```

##### `activeDuration` `string` [`format=^[0-9]+[smh]$`]

Defines for how long the policy will be active according to the
`activeSchedule`.

##### `activeSchedule` `string`

Defines when the policy should be active using the cron notation.
The policy will be active for the given `activeDuration`.

##### `annotations` `map[string][]string`

Stores additional information about an entity.

##### `applyPolicyMode` `enum(OutgoingTraffic | IncomingTraffic | Bidirectional)`

Sets three different types of policies. `IncomingTraffic`: applies the policy to
all
processing units that match the `object` and allows them to *accept* connections
from
processing units or external networks that match the `subject`.
`OutgoingTraffic`: applies
the policy to all processing units that match the `subject` and allows them to
*initiate*
connections with processing units or external networks that match the `object`.
`Bidirectional` (default): applies the policy to all processing units that match
the `object`
and allows them to *accept* connections from processing units that match the
`subject`.
Also applies the policy to all processing units that match the `subject` and
allows them
to *initiate* connections with processing units that match the `object`.

Default value:

```json
"Bidirectional"
```

##### `associatedTags` `[]string`

List of tags attached to an entity.

##### `createTime` `time` [`autogenerated`,`read_only`]

Creation date of the object.

##### `description` `string` [`max_length=1024`]

Description of the object.

##### `disabled` `boolean`

Defines if the property is disabled.

##### `encryptionEnabled` `boolean`

_This attribute is deprecated_.

Defines if the flow has to be encrypted. This property is deprecated and have no
incidence.

##### `expirationTime` `time`

If set the policy will be automatically deleted after the given time.

##### `fallback` `boolean`

Indicates that this is fallback policy. It will only be
applied if no other policies have been resolved. If the policy is also
propagated it will become a fallback for children namespaces.

##### `logsEnabled` `boolean`

If `true`, the relevant flows are logged and available from the Aporeto control
plane.
Under some advanced scenarios you may wish to set this to `false`, such as to
save space or
improve performance.

##### `metadata` `[]string` [`creation_only`]

Contains tags that can only be set during creation, must all start
with the '@' prefix, and should only be used by external systems.

##### `name` `string` [`required`,`max_length=256`]

Name of the entity.

##### `namespace` `string` [`autogenerated`,`read_only`]

Namespace tag attached to an entity.

##### `negateObject` `boolean`

Setting this to `true` will invert the object to find what is not matching.

##### `negateSubject` `boolean`

Setting this to `true` will invert the subject to find what is not matching.

##### `normalizedTags` `[]string` [`autogenerated`,`read_only`]

Contains the list of normalized tags of the entities.

##### `object` `[][]string`

A tag or tag expression identifying the object of the policy.

##### `observationEnabled` `boolean`

If set to `true`, the flow will be in observation mode.

##### `observedTrafficAction` `enum(Apply | Continue)`

If `observationEnabled` is set to `true`, this defines the final action taken
on the packets: `Apply` or `Continue` (default).

Default value:

```json
"Continue"
```

##### `ports` `[]string`

Represents the ports and protocols this policy applies to.

##### `propagate` `boolean`

Propagates the policy to all of its children.

##### `protected` `boolean`

Defines if the object is protected.

##### `subject` `[][]string`

A tag or tag expression identifying the subject of the policy.

##### `updateTime` `time` [`autogenerated`,`read_only`]

Last update date of the object.

