// WE PULL THIS CONTENT FROM https://github.com/aporeto-inc/junon
// DO NOT EDIT THIS FILE.
// YOU MUST SUBMIT A PR AGAINST THE UPSTREAM REPO.
// THE UPSTREAM REPO IS CURRENTLY PRIVATE.

== Create namespaces

=== About creating Segment namespaces

TIP: You may find it helpful to review
link:../../concepts/namespaces/[basic Segment namespace concepts] before
continuing.

Currently, you just have one Segment namespace: your root namespace. It
bears the name of your organization. For example, if we worked for Acme,
Inc., our root namespace would be `/acme`.

You should deploy Kubernetes Defenders to grandchildren namespaces and
host Defenders to great grandchildren namespaces. We need to create
children, grandchildren, and great grandchildren namespaces before we
can deploy our Defenders. Once a Defender has registered in a namespace,
you can’t move it to another namespace. You have to uninstall and
reinstall the Defender to switch namespaces.

Complete the following steps to create the recommended children,
grandchildren, and great grandchildren namespaces.

=== 1. Create child namespaces

Within your organization, you likely have more than one team or project.
For security and ease-of-use, these teams should not have access to each
others’ resources.

Create environment variables containing the names of these teams or
projects. In our example, we use `team-a` and `team-b`.

[source,console]
----
export CHILD1=team-a
export CHILD2=team-b
----

Use the following command to create the first child namespace.

[source,console]
----
cat <<EOF | apoctl api create namespace -f -
name: $CHILD1
EOF
----

Next, create the second child namespace.

[source,console]
----
cat <<EOF | apoctl api create namespace -f -
name: $CHILD2
EOF
----

Confirm the creation.

[source,console]
----
apoctl api list namespace --output yaml
----

Repeat these steps to add other children as needed.

NOTE: The children namespaces are for operators and sometimes referred
to as ``workspaces.''

=== 2. Create grandchild namespaces

In the following examples, we create grandchildren according to the
security zones of the resources. We’ll call these `dev` and `prod`.
Create environment variables as follows.

[source,console]
----
export GRANDCHILD1=dev
export GRANDCHILD2=prod
----

Use the following command to create the first grandchild namespace under
`team-a`.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD1 -f -
name: $GRANDCHILD1
EOF
----

Next, create the second grandchild namespace under `team-a`.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD1 -f -
name: $GRANDCHILD2
EOF
----

Confirm the creation.

[source,console]
----
apoctl api list namespace -n $CHILD1 --output yaml
----

Now create the first grandchild namespace under `team-b`.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD2 -f -
name: $GRANDCHILD1
EOF
----

Create the second grandchild namespace under `team-b`.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD2 -f -
name: $GRANDCHILD2
EOF
----

Confirm the creation.

[source,console]
----
apoctl api list namespace -n $CHILD2 --output yaml
----

Repeat these steps to add other grandchildren, as desired.

=== 3. Create great grandchild namespaces

If you just use Kubernetes or OpenShift, you can skip this step. If you
plan to deploy Defenders to virtual machines, you need to create a great
grandchild namespace for each host. In the following examples, we refer
to them as `vm1` and `vm2`. You should use names that describe your
hosts.

[source,console]
----
export GREATGRANDCHILD1=vm1
export GREATGRANDCHILD2=vm2
----

Use the following command to create the first great grandchild
namespace.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD1/$GRANDCHILD1 -f -
name: $GREATGRANDCHILD1
EOF
----

Next, create the second great grandchild namespace.

[source,console]
----
cat <<EOF | apoctl api create namespace -n $CHILD1/$GRANDCHILD1 -f -
name: $GREATGRANDCHILD2
EOF
----

Confirm the creation.

[source,console]
----
apoctl api list namespace -n $CHILD1/$GRANDCHILD1 --output yaml
----

Repeat these steps to add other great grandchildren, until you have one
for each of your VMs.

You should now have a very basic namespace structure and can proceed to
deploy Defenders.
