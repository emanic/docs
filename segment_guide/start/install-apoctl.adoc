// WE PULL THIS CONTENT FROM https://github.com/aporeto-inc/junon
// DO NOT EDIT THIS FILE.
// YOU MUST SUBMIT A PR AGAINST THE UPSTREAM REPO.
// THE UPSTREAM REPO IS CURRENTLY PRIVATE.

== Install apoctl

=== 1. Download apoctl

Download the executable appropriate to your platform.

* *macOS*

[source,console]
----
sudo curl -o /usr/local/bin/apoctl \
      http://download.aporeto.us/releases/release-4.0.1-rc7/apoctl/darwin/apoctl && \
sudo chmod 755 /usr/local/bin/apoctl
----

* *Linux*

[source,console]
----
sudo curl -o /usr/local/bin/apoctl \
      http://download.aporeto.us/releases/release-4.0.1-rc7/apoctl/linux/apoctl && \
sudo chmod 755 /usr/local/bin/apoctl
----

* *Windows*

[source,powershell]
----
curl http://download.aporeto.us/releases/release-4.0.1-rc7/apoctl/windows/apoctl.msi -o apoctl.msi; `
if ($?) {. .\apoctl.msi /quiet}
if ($?) {$env:PATH+="C:\Program Files\Apoctl;"}
----

=== 2. Create an app credential

Open the Segment Console web interface, expand *Manage* and select
*Authentication sources*.

Click the *Create* image:create.png[Create] button.

Type `apoctl` in the *Name* field and click *Next*.

Select *Namespace Administrator* and click *Create*.

Leave *App Credentials* selected and click *Download*.

=== 3. Configure the app credential

Rename the file to `default.creds` and copy it to the `~/.apoctl`
directory.

[source,console]
----
cp ~/Downloads/apoctl.json ~/.apoctl/default.creds
----

Set the following environment variable.

[source,console]
----
export APOCTL_CREDS=~/.apoctl/default.creds
----

Add the `APOCTL_CREDS` variable to your bash profile so it persists
across reboots.

[source,console]
----
echo "export APOCTL_CREDS=$APOCTL_CREDS" | tee -a ~/.bash_profile
----

=== 4. Confirm your credentials

Issue the following command to confirm that you’re authenticated.

[source,console]
----
apoctl auth verify
----

It should return something like the following.

[source,json]
----
{
  "data": {
    "commonName": "app:credential:5f076b12f0fe17068f68b5c9:apoctl2",
    "organization": "/acme",
    "realm": "certificate",
    "serialNumber": "150584903206327682356477212780811890761",
    "subject": "150584903206327682356477212780811890761"
  },
  "exp": 1594331770,
  "iat": 1594320970,
  "iss": "https://segment.acme.com:4443",
  "realm": "Certificate",
  "restrictions": {},
  "sub": "150584903206327682356477212780811890761"
}
----

Congratulations! You’ve installed and configured `apoctl`.
