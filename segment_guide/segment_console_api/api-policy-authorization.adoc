== policy/authorization

=== APIAuthorizationPolicy

An API authorization defines the operations a user can perform in a
namespace: `GET`, `POST`, `PUT`, `DELETE`, `PATCH`, and/or `HEAD`. It is
also possible to restrict the user to a subset of the APIs in the
namespace by setting `authorizedIdentities`. An API authorization always
propagates down to all the children of the current namespace.

==== Example

[source,json]
----
{
  "authorizedIdentities": [
    "@auth:role=namespace.administrator"
  ],
  "authorizedNamespace": "/namespace",
  "disabled": false,
  "fallback": false,
  "name": "the name",
  "propagationHidden": false,
  "protected": false
}
----

==== Relations

===== `GET /apiauthorizationpolicies`

Retrieves the list of API authorizations.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /apiauthorizationpolicies`

Creates a new API authorization.

===== `DELETE /apiauthorizationpolicies/:id`

Deletes the authorization with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /apiauthorizationpolicies/:id`

Retrieves the authorization with the given ID.

===== `PUT /apiauthorizationpolicies/:id`

Updates the authorization with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `activeDuration` [`format=^[0-9]+[smh]$`]

Type: `string`

Defines for how long the policy will be active according to the
`activeSchedule`.

===== `activeSchedule`

Type: `string`

Defines when the policy should be active using the cron notation. The
policy will be active for the given `activeDuration`.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `authorizedIdentities` [`required`]

Type: `[]string`

A list of roles assigned to the user.

===== `authorizedNamespace` [`required`]

Type: `string`

Defines the namespace the user is authorized to access.

===== `authorizedSubnets`

Type: `[]string`

If set, the API authorization will only be valid if the request comes
from one the declared subnets.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `expirationTime`

Type: `time`

If set, the policy will be automatically deleted after the given time.

===== `fallback`

Type: `boolean`

Indicates that this is fallback policy. It will only be applied if no
other policies have been resolved. If the policy is also propagated it
will become a fallback for children namespaces.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `propagationHidden`

Type: `boolean`

If set to `true` while the policy is propagating, it wonâ€™t be visible to
children namespace, but still used for policy resolution.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subject`

Type: `[][]string`

A tag or tag expression that identifies the authorized user(s).

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== APICheck

Allows you to verify if a client identified by his token is allowed to
do some operations on some APIs.

==== Example

[source,json]
----
{
  "namespace": "/namespace",
  "operation": "Create",
  "targetIdentities": [
    "processingunit",
    "enforcer"
  ]
}
----

==== Relations

===== `POST /apichecks`

Verifies the authorizations on various identities for a given token.

==== Attributes

===== `authorized` [`autogenerated`,`read_only`]

Type: `map[string]bool`

Contains the results of the check.

===== `namespace` [`required`]

Type: `string`

The namespace to use to check the API authorization.

===== `operation` [`required`]

Type:
`enum(Create | Delete | Info | Patch | Retrieve | RetrieveMany | Update)`

The operation you want to check.

===== `targetIdentities` [`required`]

Type: `[]string`

Contains the list of identities you want to check the authorization of.

=== AppCredential

Create an app credential.

==== Example

[source,json]
----
{
  "CSR": "-----BEGIN CERTIFICATE REQUEST-----
MIICvDCCAaQCAQAwdzELMAkGA1UEBhMCVVMxDTALBgNVBAgMBFV0YWgxDzANBgNV
BAcMBkxpbmRvbjEWMBQGA1UECgwNRGlnaUNlcnQgSW5jLjERMA8GA1UECwwIRGln
aUNlcnQxHTAbBgNVBAMMFGV4YW1wbGUuZGlnaWNlcnQuY29tMIIBIjANBgkqhkiG
9w0BAQEFAAOCAQ8AMIIBCgKCAQEA8+To7d+2kPWeBv/orU3LVbJwDrSQbeKamCmo
wp5bqDxIwV20zqRb7APUOKYoVEFFOEQs6T6gImnIolhbiH6m4zgZ/CPvWBOkZc+c
1Po2EmvBz+AD5sBdT5kzGQA6NbWyZGldxRthNLOs1efOhdnWFuhI162qmcflgpiI
WDuwq4C9f+YkeJhNn9dF5+owm8cOQmDrV8NNdiTqin8q3qYAHHJRW28glJUCZkTZ
wIaSR6crBQ8TbYNE0dc+Caa3DOIkz1EOsHWzTx+n0zKfqcbgXi4DJx+C1bjptYPR
BPZL8DAeWuA8ebudVT44yEp82G96/Ggcf7F33xMxe0yc+Xa6owIDAQABoAAwDQYJ
KoZIhvcNAQEFBQADggEBAB0kcrFccSmFDmxox0Ne01UIqSsDqHgL+XmHTXJwre6D
hJSZwbvEtOK0G3+dr4Fs11WuUNt5qcLsx5a8uk4G6AKHMzuhLsJ7XZjgmQXGECpY
Q4mC3yT3ZoCGpIXbw+iP3lmEEXgaQL0Tx5LFl/okKbKYwIqNiyKWOMj7ZR/wxWg/
ZDGRs55xuoeLDJ/ZRFf9bI+IaCUd1YrfYcHIl3G87Av+r49YVwqRDT0VDV7uLgqn
29XI1PpVUNCPQGn9p/eX6Qo7vpDaPybRtA2R7XLKjQaF9oXWeCUqy1hvJac9QFO2
97Ob1alpHPoZ7mWiEuJwjBPii6a9M9G30nUo39lBi1w=
-----END CERTIFICATE REQUEST-----",
  "disabled": false,
  "name": "the name",
  "protected": false,
  "roles": [
    "@auth:role=enforcer",
    "@auth:role=kubesquall"
  ]
}
----

==== Relations

===== `GET /appcredentials`

Retrieves the list of app credentials.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /appcredentials`

Creates a new app credential.

===== `DELETE /appcredentials/:id`

Deletes the app credential with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /appcredentials/:id`

Retrieves the app credential with the given ID.

===== `PUT /appcredentials/:id`

Updates the app credential with the given ID.

==== Attributes

===== `CSR`

Type: `string`

Contains a PEM-encoded certificate signing request (CSR). It can only be
set during a renew.

* The CN *MUST* be `app:credential:<appcred-id>:<appcred-name>`
* The O *MUST* be the namespace of the app credential

If you send anything else, the signing request will be rejected.

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `authorizedSubnets`

Type: `[]string`

If set, the app credential will only be valid if the request comes from
one the declared subnets.

===== `certificate` [`read_only`]

Type: `string`

The string representation of the certificate used by the app credential.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `credentials` [`autogenerated`,`read_only`]

Type: link:#credential[`credential`]

The app credential data.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `email`

Type: `string`

The email address that will receive a copy of the app credential.

===== `maxIssuedTokenValidity`

Type: `string`

If set, this will limit the maximum validity of the token issued from
this app credential. This information will be embedded into the
delivered certificate and cannot be changed once set. In order to change
it, you need to renew the certificate.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `parentIDs` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the ID of the parent app credential if this is a derived app
credential.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `roles` [`required`]

Type: `[]string`

List of roles to give the app credential.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== Credential

Represents an app credential.

==== Attributes

===== `APIURL`

Type: `string`

The URL of the Segment Console API.

===== `ID`

Type: `string`

The ID of the app credential.

===== `certificate`

Type: `string`

The base64-encoded certificate.

===== `certificateAuthority`

Type: `string`

The base64-encoded certificate authority.

===== `certificateKey`

Type: `string`

The base64-encoded certificate key.

===== `name`

Type: `string`

The name of the app credential.

===== `namespace`

Type: `string`

The namespace of the app credential.

=== Role

Returns the available roles that can be used with API authorizations.

==== Relations

===== `GET /roles`

Retrieves the list of existing roles.

==== Attributes

===== `authorizations` [`autogenerated`,`read_only`]

Type: `map[string][]string`

Authorizations of the role.

===== `description` [`autogenerated`,`read_only`]

Type: `string`

Description of the role.

===== `key` [`autogenerated`,`read_only`]

Type: `string`

Key of the role.

===== `name` [`autogenerated`,`read_only`]

Type: `string`

Name of the role.

===== `private` [`autogenerated`,`read_only`]

Type: `boolean`

Set to `true` to make the role private and hidden from the UI.
