== core

=== Comment

Represents a comment from a user.

==== Attributes

===== `claims`

Type: `[]string`

The claims of the author.

===== `content`

Type: `string`

The content of the comment.

===== `date`

Type: `time`

The date of the comment.

=== Export

Allows you to obtain a JSON object containing policies and other objects
from a given namespace. You can then import this JSON object into a
different namespace.

==== Example

[source,json]
----
{
  "identities": [
    "externalnetworks",
    "networkaccesspolicies"
  ],
  "label": "my-import-name"
}
----

==== Relations

===== `POST /export`

Exports all policies and related objects of a namespace.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

==== Attributes

===== `APIVersion` [`autogenerated`,`read_only`]

Type: `integer`

Version of the Segment Console API used for the exported data.

===== `data` [`autogenerated`]

Type: `map[string][]map[string]interface{}`

List of all exported data.

===== `identities`

Type: `[]string`

The list of identities to export.

===== `label`

Type: `string`

Allows you to define a unique label for this export. When importing the
content of the export, this label will be added as a tag that will be
used to recognize imported object in a later import.

=== Hit

This API allows to retrieve a generic hit counter for a given object.

==== Example

[source,json]
----
{
  "name": "counter",
  "targetIdentity": "networkaccesspolicy"
}
----

==== Relations

===== `GET /hits`

Retrieve a matching hit.

Parameters:

* `name` (`string`): The name of the counter.
* `targetID` (`string`): The ID of the object associated to the counter.
* `targetIdentity` (`string`): The identity of the object associated to
the counter.

Mandatory Parameters

(`name` and `targetID` and `targetIdentity`) or (`targetID` and
`targetIdentity`)

===== `POST /hits`

Manage hits.

Parameters:

* `reset` (`boolean`): If set the hit will reset to 0.

==== Attributes

===== `name` [`required`]

Type: `string`

name of the counter.

Default value:

[source,json]
----
"counter"
----

===== `targetID`

Type: `string`

The ID of the referenced object..

===== `targetIdentity` [`required`]

Type: `string`

The identity of the referenced object.

===== `value` [`read_only`]

Type: `integer`

The value of the hit.

=== Import

Imports an export of policies and related objects into the namespace.

==== Example

[source,json]
----
{
  "data": {
    "externalnetworks": [
      {
        "associatedTags": [
          "ext:net=tcp"
        ],
        "description": "Represents all TCP traffic on any port",
        "entries": [
          "0.0.0.0/0"
        ],
        "name": "all-tcp",
        "protocols": [
          "tcp"
        ]
      },
      {
        "associatedTags": [
          "ext:net=udp"
        ],
        "description": "Represents all UDP traffic on any port",
        "entries": [
          "0.0.0.0/0"
        ],
        "name": "all-udp",
        "protocols": [
          "udp"
        ]
      }
    ],
    "networkaccesspolicies": [
      {
        "action": "Allow",
        "description": "Allows all communication from pu to pu, tcp and udp",
        "logsEnabled": true,
        "name": "allow-all-communication",
        "object": [
          [
            "$identity=processingunit"
          ],
          [
            "ext:net=tcp"
          ],
          [
            "ext:net=udp"
          ]
        ],
        "subject": [
          [
            "$identity=processingunit"
          ]
        ]
      }
    ]
  },
  "mode": "Import"
}
----

==== Relations

===== `POST /import`

Imports data from a previous export.

==== Attributes

===== `data` [`required`]

Type: link:#export[`export`]

Data to import.

===== `mode`

Type: `enum(ReplacePartial | Import | Remove)`

How to import the data: `ReplacePartial`, `Import` (default), or
`Remove`. `ReplacePartial` is deprecated. Use `Import` instead. While
you can use `ReplacePartial` it will be interpreted as `Import`.

Default value:

[source,json]
----
"Import"
----

=== ImportReference

Allows you to import and keep a reference.

==== Example

[source,json]
----
{
  "constraint": "Unrestricted",
  "data": {
    "externalnetworks": [
      {
        "associatedTags": [
          "ext:net=tcp"
        ],
        "description": "Represents all TCP traffic on any port",
        "entries": [
          "0.0.0.0/0"
        ],
        "name": "all-tcp",
        "protocols": [
          "tcp"
        ]
      },
      {
        "associatedTags": [
          "ext:net=udp"
        ],
        "description": "Represents all UDP traffic on any port",
        "entries": [
          "0.0.0.0/0"
        ],
        "name": "all-udp",
        "protocols": [
          "udp"
        ]
      }
    ],
    "networkaccesspolicies": [
      {
        "action": "Allow",
        "description": "Allows all communication from pu to pu, tcp and udp",
        "logsEnabled": true,
        "name": "allow-all-communication",
        "object": [
          [
            "$identity=processingunit"
          ],
          [
            "ext:net=tcp"
          ],
          [
            "ext:net=udp"
          ]
        ],
        "subject": [
          [
            "$identity=processingunit"
          ]
        ]
      }
    ]
  },
  "name": "the name",
  "protected": false
}
----

==== Relations

===== `GET /importreferences`

Retrieves the list of import references.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /importreferences`

Imports data from a previous export and keep a reference.

===== `DELETE /importreferences/:id`

Deletes the object with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /importreferences/:id`

Retrieves the object with the given ID.

===== `GET /recipes/:id/importreferences`

Returns the list of import references that depend on a recipe.

===== `POST /recipes/:id/importreferences`

Create an import request for the given recipe.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `claims` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the claims of the client that performed the import.

===== `constraint`

Type: `enum(Unrestricted | Unique | NamespaceUnique)`

Define the import constraint. If Unrestricted, import can be deployed
multiple times. If Unique, only one import is allowed in the current
namespace and its child namespaces. If NamespaceUnique, only one import
is allowed in the current namespace.

Default value:

[source,json]
----
"Unrestricted"
----

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `data` [`required`]

Type: link:#export[`export`]

Data to import.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `label` [`autogenerated`]

Type: `string`

Label used for the imported data.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== ImportRequest

Allows you to send an import request to create objects to a namespace
where the requester doesnâ€™t normally have the permission to do so (other
than creating import requests).

The requester must have the permission to create the request in their
namespace and the target namespace.

When the request is created, the status is set to `Draft`. The requester
can edit the content as much as desired. When ready to send the request,
update the status to `Submitted`. The request will then be moved to the
target namespace. At that point nobody can edit the content of the
requests other than adding comments.

The requestee will now see the request, and will either

* Set the status as `Approved`. This will create the objects in the
target namespace.
* Set the status as `Rejected`. The request cannot be edited anymore and
can be deleted.
* Set the status back as `Draft`. The request will go back to the
requester namespace so that the requester can make changes. Once the
change are ready, the requester will set back the status as `Submitted`.

The `data` format is the same as `Export`.

==== Example

[source,json]
----
{
  "data": {
    "networkaccesspolicies": [
      {
        "action": "Allow",
        "description": "Allows Acme to access service A",
        "logsEnabled": true,
        "name": "allow-acme",
        "object": [
          [
            "$identity=processingunit",
            "$namespace=/acme/prod",
            "app=query"
          ]
        ],
        "subject": [
          [
            "$identity=processingunit",
            "app=partner-data"
          ]
        ]
      }
    ]
  },
  "protected": false,
  "requesterClaims": [
    "@auth:realm=vince",
    "@auth:account=acme"
  ],
  "status": "Draft",
  "targetNamespace": "/acme/prod"
}
----

==== Relations

===== `GET /importrequests`

Retrieves the list of import requests.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /importrequests`

Creates a new import request.

===== `DELETE /importrequests/:id`

Delete an existing import request.

===== `GET /importrequests/:id`

Retrieve a single existing import request.

===== `PUT /importrequests/:id`

Update an existing import request.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `comment`

Type: `string`

A new comment that will be added to `commentFeed`.

===== `commentFeed` [`autogenerated`,`read_only`]

Type: link:#comment[`comment`]

List of comments that have been added to that request.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `data` [`required`]

Type: `map[string][]map[string]interface{}`

Data to import.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `requesterClaims` [`autogenerated`,`read_only`]

Type: `[]string`

The identity claims of the requester; populated by Segment Console.

===== `requesterNamespace` [`autogenerated`,`read_only`]

Type: `string`

The namespace from which the request originated; populated by Segment
Console.

===== `status`

Type: `enum(Draft | Submitted | Approved | Rejected)`

Allows the content to be changed. `Submitted`: the request moves to the
target namespace for approval. `Approved`: the data will be created
immediately. `Rejected`: the request cannot be changed anymore and can
be deleted.

Default value:

[source,json]
----
"Draft"
----

===== `targetNamespace` [`required`,`creation_only`]

Type: `string`

The namespace where the request will be sent. The requester can set any
namespace but needs to have an authorization to post the request in that
namespace.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== Poke

When available, poke can be used to update various information about the
parent. For instance, for defenders, poke will be used as the heartbeat.

==== Relations

===== `GET /enforcers/:id/poke`

Sends a poke empty object. This is used to ensure a defender is up and
running.

Parameters:

* `cpuload` (`float`): Deprecated.
* `enforcementStatus` (`enum(Failed | Inactive | Active)`): If set,
changes the enforcement status of the defender alongside with the poke.
* `forceFullPoke` (`boolean`): If set, it will trigger a full poke
(slower).
* `memory` (`integer`): Deprecated.
* `processes` (`integer`): Deprecated.
* `sessionClose` (`boolean`): If set, terminates a session for a
defender.
* `sessionID` (`string`): If set, sends the current session ID of a
defender.
* `status` (`enum(Registered | Connected | Disconnected)`): If set,
changes the status of the defender alongside with the poke.
* `ts` (`time`): time of report. If not set, local server time will be
used.
* `version` (`string`): If set, version of the current running defender.
* `zhash` (`integer`): Can be set to help backend target the correct
shard where the defender is stored.

===== `GET /processingunits/:id/poke`

Sends a poke empty object. This will send a snapshot of the processing
unit to the time series database.

Parameters:

* `enforcementStatus` (`enum(Failed | Inactive | Active)`): If set,
changes the enforcement status of the processing unit alongside with the
poke.
* `forceFullPoke` (`boolean`): If set, it will trigger a full poke
(slower).
* `notify` (`boolean`): Can be sent to trigger a `ProcessingUnitRefresh`
event that will be handled by the defender. If this is set, all other
additional parameters will be ignored.
* `status` (`enum(Initialized | Paused | Running | Stopped)`): If set,
changes the status of the processing unit alongside with the poke.
* `ts` (`time`): time of report. If not set, local server time will be
used.
* `zhash` (`integer`): Can be set to help backend target the correct
shard where the processing unit is stored.

=== PolicyRenderer

Allows you to render policies of a given type for a given set of tags.

==== Example

[source,json]
----
{
  "processMode": "Subject",
  "tags": [
    "a=a",
    "b=b"
  ],
  "type": "APIAuthorization"
}
----

==== Relations

===== `POST /policyrenderers`

Render a policy of a given type for a given set of tags.

==== Attributes

===== `policies` [`autogenerated`,`read_only`]

Type: link:#policyrule[`policyrule`]

List of policies rendered for the given set of tags.

===== `processMode`

Type: `enum(Subject | Object)`

`Subject` (default): Set if the `processMode` should use the subject.
`Object`: Set if the `processMode` should use the object. This only has
effect when rendering an SSH authorization for now.

Default value:

[source,json]
----
"Subject"
----

===== `tags` [`required`]

Type: `[]string`

List of tags of the object to render the hook for.

===== `type` [`required`]

Type:
`enum(APIAuthorization | EnforcerProfile | File | Hook | Infrastructure | NamespaceMapping | Network | ProcessingUnit | Quota | Syscall | TokenScope | SSHAuthorization | UserAccess)`

Type of policy to render.

=== Search

Perform a full text search on the database.

==== Relations

===== `GET /search`

Perform a full text search on the database.

Parameters:

* `q` (`string`): search query.

Mandatory Parameters

`q`

==== Attributes

===== `object` [`autogenerated`,`read_only`]

Type: `object`

Contains the matched object.

===== `objectID` [`autogenerated`,`read_only`]

Type: `string`

Contains the ID of the match.

===== `objectIdentity` [`autogenerated`,`read_only`]

Type: `string`

Contains the identity of the match.

===== `objectNamespace` [`autogenerated`,`read_only`]

Type: `string`

Contains the namespace of the match.

===== `score` [`autogenerated`,`read_only`]

Type: `float`

Contains the score of the match.
