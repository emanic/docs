== policy/processingunits

=== IsolationProfile

Defines system call rules, system call actions, and other capabilities
on a processing unit.

==== Example

[source,json]
----
{
  "name": "the name",
  "propagate": false,
  "protected": false
}
----

==== Relations

===== `GET /isolationprofiles`

Retrieves the list of isolation profiles.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /isolationprofiles`

Creates a new isolation profile.

===== `DELETE /isolationprofiles/:id`

Deletes the profile with the given ID.

===== `GET /isolationprofiles/:id`

Retrieves the profile with the given ID.

Parameters:

* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `PUT /isolationprofiles/:id`

Updates the profile with the given ID.

===== `GET /processingunitpolicies/:id/isolationprofiles`

Returns the list of isolation profiles associated with the mapping.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `capabilitiesActions`

Type: `_cap_map`

The capabilities that should be added to or removed from the processing
unit.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `defaultSyscallAction`

Type: `_syscall_action`

The default action applied to all system calls of this profile. Default
is `Allow`.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `syscallRules`

Type: `_syscall_rules`

A list of system call rules that identify actions for particular system
calls.

===== `targetArchitectures`

Type: `_arch_list`

The processor architectures that the profile supports. Default `all`.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== ProcessingUnitPolicy

Processing unit policies allow you to define special behavior for
processing units. For example you can associate an isolation profile
with a set of processing units or select a specific datapath.

==== Example

[source,json]
----
{
  "action": "Default",
  "datapathType": "Default",
  "disabled": false,
  "fallback": false,
  "name": "the name",
  "propagate": false,
  "protected": false
}
----

==== Relations

===== `GET /processingunitpolicies`

Retrieves the list of processing unit policies.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /processingunitpolicies`

Creates a new processing unit policy.

===== `DELETE /processingunitpolicies/:id`

Deletes the object with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /processingunitpolicies/:id`

Retrieves the object with the given ID.

===== `PUT /processingunitpolicies/:id`

Updates the object with the given ID.

===== `GET /processingunitpolicies/:id/isolationprofiles`

Returns the list of isolation profiles associated with the mapping.

===== `GET /processingunitpolicies/:id/processingunits`

Returns the list of processing units referenced by the mapping.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `action`

Type:
`enum(Default | Delete | Enforce | LogCompliance | Reject | Snapshot | Stop)`

Action determines the action to take while enforcing the isolation
profile. NOTE: Choose `Default` if your processing unit is not supposed
to make a decision on isolation profiles at all.

Default value:

[source,json]
----
"Default"
----

===== `activeDuration` [`format=^[0-9]+[smh]$`]

Type: `string`

Defines for how long the policy will be active according to the
`activeSchedule`.

===== `activeSchedule`

Type: `string`

Defines when the policy should be active using the cron notation. The
policy will be active for the given `activeDuration`.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `datapathType`

Type: `enum(Default | Aporeto | EnvoyAuthorizer)`

The datapath type that processing units selected by `subject` should
implement: - `Default`: This policy is not making a decision for the
datapath. - `Aporeto`: The defender is managing and handling the
datapath. - `EnvoyAuthorizer`: The defender is serving Envoy-compatible
gRPC APIs for every processing unit that for example can be used by an
Envoy proxy to use the Segment PKI and implement Segment network
policies. NOTE: The defender is not going to own the datapath in this
example. It is merely providing an authorizer API.

Default value:

[source,json]
----
"Default"
----

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `fallback`

Type: `boolean`

Indicates that this is fallback policy. It will only be applied if no
other policies have been resolved. If the policy is also propagated it
will become a fallback for children namespaces.

===== `isolationProfileSelector`

Type: `[][]string`

The isolation profiles to be mapped. Only applies to `Enforce` and
`LogCompliance` actions.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subject`

Type: `[][]string`

Contains the tag expression the tags need to match for the policy to
apply.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== ProcessingUnitService

Represents a service attached to a processing unit.

==== Attributes

===== `ports` [`read_only`]

_This attribute is deprecated_.

Type: `string`

Contains the list of allowed ports and ranges.

===== `protocol`

Type: `integer`

Protocol used by the service.

===== `targetPorts`

Type: `[]string`

List of single ports or range (xx:yy).
