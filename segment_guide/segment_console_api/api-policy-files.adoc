== policy/files

=== FileAccessPolicy

A file access policy allows processing units to access various folder
and files. It will use the tags of a file path to know what is the path
of the file or folder to allow access to. You can allow the processing
unit to have any combination of read, write, or execute.

When a processing unit is a Docker container, then it will police the
volumes. Mount and execute wonâ€™t have any effect.

File paths are not supported yet for standard Linux processes.

==== Example

[source,json]
----
{
  "allowsExecute": false,
  "allowsRead": false,
  "allowsWrite": false,
  "disabled": false,
  "encryptionEnabled": false,
  "fallback": false,
  "logsEnabled": false,
  "name": "the name",
  "propagate": false,
  "protected": false
}
----

==== Relations

===== `GET /fileaccesspolicies`

Retrieves the list of file access policies.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /fileaccesspolicies`

Creates a new file access policies.

===== `DELETE /fileaccesspolicies/:id`

Deletes the policy with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /fileaccesspolicies/:id`

Retrieves the policy with the given ID.

===== `PUT /fileaccesspolicies/:id`

Updates the policy with the given ID.

===== `GET /fileaccesspolicies/:id/filepaths`

Returns the list of file paths that match the policy.

===== `GET /fileaccesspolicies/:id/processingunits`

Returns the list of processing units that match the policy.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `activeDuration` [`format=^[0-9]+[smh]$`]

Type: `string`

Defines for how long the policy will be active according to the
`activeSchedule`.

===== `activeSchedule`

Type: `string`

Defines when the policy should be active using the cron notation. The
policy will be active for the given `activeDuration`.

===== `allowsExecute`

Type: `boolean`

Allows files to be executed.

===== `allowsRead`

Type: `boolean`

Allows files to be read.

===== `allowsWrite`

Type: `boolean`

Allows files to be written.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `encryptionEnabled`

Type: `boolean`

Set to `true` to enable automatic encryption.

===== `expirationTime`

Type: `time`

If set the policy will be automatically deleted after the given time.

===== `fallback`

Type: `boolean`

Indicates that this is fallback policy. It will only be applied if no
other policies have been resolved. If the policy is also propagated it
will become a fallback for children namespaces.

===== `logsEnabled`

Type: `boolean`

A value of `true` enables logging.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `object`

Type: `[][]string`

The object of the policy.

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subject`

Type: `[][]string`

The subject of the policy.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== FileAccessReport

Post a new file access report.

==== Example

[source,json]
----
{
  "action": "Accepted",
  "host": "localhost",
  "mode": "rxw",
  "path": "/etc/passwd",
  "processingUnitID": "xxx-xxx-xxx-xxx",
  "processingUnitNamespace": "/my/ns",
  "timestamp": "2018-06-14T23:10:46.420397985Z"
}
----

==== Relations

===== `POST /fileaccessreports`

Create a file access statistics report.

==== Attributes

===== `action` [`required`]

Type: `enum(Accept | Reject | Limit)`

Action taken.

===== `host` [`required`]

Type: `string`

Host storing the file.

Default value:

[source,json]
----
"localhost"
----

===== `mode` [`required`]

Type: `string`

Mode of file access.

Default value:

[source,json]
----
"rxw"
----

===== `path` [`required`]

Type: `string`

Path of the file.

Default value:

[source,json]
----
"/etc/passwd"
----

===== `processingUnitID` [`required`]

Type: `string`

ID of the processing unit.

===== `processingUnitNamespace` [`required`]

Type: `string`

Namespace of the processing unit.

===== `timestamp` [`required`]

Type: `time`

Date of the report.

=== FilePath

A file path represents a random path to a file or a folder. They can be
used in file access policies to allow processing units to access them,
using various modes (read, write, execute). You will need to use the
file paths tags to set some policies. A good example would be
`volume=web` or `file=/etc/passwd`.

==== Example

[source,json]
----
{
  "filepath": "/etc/passwd",
  "name": "the name",
  "propagate": false,
  "protected": false
}
----

==== Relations

===== `GET /filepaths`

Retrieves the list of file paths.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `archived` (`boolean`): Also retrieve the objects that have been
archived.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /filepaths`

Create a new file path.

===== `DELETE /filepaths/:id`

Deletes the object with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /filepaths/:id`

Retrieves the object with the given ID.

Parameters:

* `archived` (`boolean`): Also retrieve the objects that have been
archived.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `PUT /filepaths/:id`

Updates the object with the given ID.

===== `GET /fileaccesspolicies/:id/filepaths`

Returns the list of file paths that match the policy.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `filepath` [`required`]

Type: `string`

FilePath refer to the file mount path.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `server` [`creation_only`]

Type: `string`

server is the server name/ID/IP associated with the file path.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.
