== policy/networking

=== Claims

Represents the claims in the token used to access a service.

==== Example

[source,json]
----
{
  "content": {
    "exp": 1553899021,
    "iat": 1553888221,
    "iss": "https://accounts.acme.com",
    "sub": "alice@acme.com"
  },
  "hash": "1134423925458173049"
}
----

==== Relations

===== `GET /claims`

Retrieves the list of claims.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /claims`

Creates a new claims record.

===== `GET /claims/:id`

Retrieves the object with the given ID.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `content` [`creation_only`]

Type: `map[string]string`

Contains the raw JSON web token (JWT) claims.

===== `hash` [`required`]

Type: `string`

XXH64 hash of the claims content. It will be used as ID. To compute a
correct hash, you must first clob `content` as an string array in the
form `key=value`, sort it then apply the XXH64 function.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

=== ExternalNetwork

An external network represents a random network or IP address that is
not managed by Segment. External networks can be used in network
policies to allow traffic from or to the declared network or IP, using
the provided protocol and port (or range of ports). If you want to
describe the internet (i.e., anywhere), use `0.0.0.0/0` as the address
and `1-65000` for the ports. You must assign the external network one or
more tags. These allow you to reference the external network from your
network policies.

==== Example

[source,json]
----
{
  "name": "the name",
  "propagate": false,
  "protected": false,
  "type": "Subnet"
}
----

==== Relations

===== `GET /externalnetworks`

Retrieves the list of external networks.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `archived` (`boolean`): Also retrieve the objects that have been
archived.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /externalnetworks`

Creates a new external network.

===== `DELETE /externalnetworks/:id`

Deletes the object with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /externalnetworks/:id`

Retrieves the object with the given ID.

Parameters:

* `archived` (`boolean`): Also retrieve the objects that have been
archived.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `PUT /externalnetworks/:id`

Updates the object with the given ID.

===== `GET /infrastructurepolicies/:id/externalnetworks`

Returns the list of external networks affected by an infrastructure
policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

===== `GET /networkaccesspolicies/:id/externalnetworks`

Returns the list of external networks affected by a network policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `entries`

Type: `[]string`

List of CIDRs or domain name.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `ports`

_This attribute is deprecated_.

Type: `[]string`

List of single ports or range (xx:yy).

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `protocols`

_This attribute is deprecated_.

Type: `[]string`

List of protocols (`tcp`, `udp`, or protocol number).

===== `servicePorts`

Type: `[]string`

List of protocol/ports `(tcp/80)` or `(udp/80:100)`.

===== `type`

Type: `enum(ENI | RDSCluster | RDSInstance | SecurityGroup | Subnet)`

The type of external network (default `Subnet`).

Default value:

[source,json]
----
"Subnet"
----

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== FlowReport

Post a new flow log.

==== Example

[source,json]
----
{
  "action": "Accept",
  "destinationController": "api.east.acme.com",
  "destinationID": "xxx-xxx-xxx",
  "destinationNamespace": "/my/namespace",
  "destinationType": "ProcessingUnit",
  "encrypted": false,
  "namespace": "/my/namespace",
  "observed": false,
  "observedAction": "NotApplicable",
  "observedEncrypted": false,
  "observedPolicyID": "xxx-xxx-xxx",
  "observedPolicyNamespace": "/my/namespace",
  "policyID": "xxx-xxx-xxx",
  "policyNamespace": "/my/namespace",
  "protocol": 6,
  "serviceType": "NotApplicable",
  "sourceController": "api.west.acme.com",
  "sourceID": "xxx-xxx-xxx",
  "sourceNamespace": "/my/namespace",
  "sourceType": "ProcessingUnit",
  "value": 1
}
----

==== Relations

===== `POST /flowreports`

Create a flow statistics report.

==== Attributes

===== `action` [`required`]

Type: `enum(Accept | Reject)`

Action applied to the flow.

===== `destinationController`

Type: `string`

Identifier of the destination controller.

===== `destinationID` [`required`]

Type: `string`

ID of the destination.

===== `destinationIP`

Type: `string`

Destination IP address.

===== `destinationNamespace`

_This attribute is deprecated_.

Type: `string`

Namespace of the destination. This is deprecated. Use `remoteNamespace`.
This property does nothing.

===== `destinationPort`

Type: `integer`

Port of the destination.

===== `destinationType` [`required`]

Type: `enum(ProcessingUnit | ExternalNetwork | Claims)`

Destination type.

===== `dropReason`

Type: `string`

This field is only set if `action` is set to `Reject`. It specifies the
reason for the rejection.

===== `encrypted`

Type: `boolean`

If `true`, the flow was encrypted.

===== `namespace` [`required`]

_This attribute is deprecated_.

Type: `string`

This is here for backward compatibility.

===== `observed`

Type: `boolean`

If `true`, design mode is on.

===== `observedAction`

Type: `enum(Accept | Reject | NotApplicable)`

Action observed on the flow.

Default value:

[source,json]
----
"NotApplicable"
----

===== `observedDropReason`

Type: `string`

Specifies the reason for a rejection. Only set if `observedAction` is
set to `Reject`.

===== `observedEncrypted`

Type: `boolean`

Value of the encryption of the network policy that observed the flow.

===== `observedPolicyID`

Type: `string`

ID of the network policy that observed the flow.

===== `observedPolicyNamespace`

Type: `string`

Namespace of the network policy that observed the flow.

===== `policyID` [`required`]

Type: `string`

ID of the network policy that accepted the flow.

===== `policyNamespace` [`required`]

Type: `string`

Namespace of the network policy that accepted the flow.

===== `protocol` [`required`]

Type: `integer`

Protocol number.

===== `remoteNamespace`

Type: `string`

Namespace of the object at the other end of the flow.

===== `serviceClaimHash`

Type: `string`

Hash of the claims used to communicate.

===== `serviceID`

Type: `string`

ID of the service.

===== `serviceNamespace`

Type: `string`

Namespace of Service accessed.

===== `serviceType`

Type: `enum(L3 | HTTP | TCP | NotApplicable)`

ID of the service.

Default value:

[source,json]
----
"NotApplicable"
----

===== `serviceURL`

Type: `string`

Service URL accessed.

===== `sourceController`

Type: `string`

Identifier of the source controller.

===== `sourceID` [`required`]

Type: `string`

ID of the source.

===== `sourceIP`

Type: `string`

Type of the source.

===== `sourceNamespace`

_This attribute is deprecated_.

Type: `string`

Namespace of the source. This is deprecated. Use `remoteNamespace`. This
property does nothing.

===== `sourceType` [`required`]

Type: `enum(ProcessingUnit | ExternalNetwork | Claims)`

Type of the source.

===== `timestamp`

Type: `time`

Time and date of the log.

===== `value` [`required`]

Type: `integer`

Number of flows in the log.

=== InfrastructurePolicy

Infrastructure policies represent the network access rules of the
underlying infrastructure. They can assist you in analyzing how AWS
security groups, firewalls, and other access control list (ACL)
mechanisms may affect Segment network policies. Segmentâ€™s AWS
integration app automatically populates AWS security groups.

==== Example

[source,json]
----
{
  "action": "Allow",
  "applyPolicyMode": "OutgoingTraffic",
  "disabled": false,
  "name": "the name",
  "protected": false
}
----

==== Relations

===== `GET /infrastructurepolicies`

Retrieves the list of infrastructure policies.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `POST /infrastructurepolicies`

Creates a new infrastructure policy.

===== `DELETE /infrastructurepolicies/:id`

Deletes the infrastructure policy with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /infrastructurepolicies/:id`

Retrieves the infrastructure policy with the given ID.

===== `PUT /infrastructurepolicies/:id`

Updates the infrastructure policy with the given ID.

===== `GET /infrastructurepolicies/:id/externalnetworks`

Returns the list of external networks affected by an infrastructure
policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

===== `GET /infrastructurepolicies/:id/processingunits`

Returns the list of processing units affected by an infrastructure
policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

===== `GET /infrastructurepolicies/:id/services`

Returns the list of services affected by an infrastructure policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `action`

Type: `enum(Allow | Reject)`

Defines the action to apply to a flow.

Default value:

[source,json]
----
"Allow"
----

===== `activeDuration` [`format=^[0-9]+[smh]$`]

Type: `string`

Defines for how long the policy will be active according to the
`activeSchedule`.

===== `activeSchedule`

Type: `string`

Defines when the policy should be active using the cron notation. The
policy will be active for the given `activeDuration`.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `applyPolicyMode`

Type: `enum(OutgoingTraffic | IncomingTraffic)`

Determines if the policy applies to the outgoing traffic of the
`subject` or the incoming traffic of the `subject`. `OutgoingTraffic`
(default) or `IncomingTraffic`.

Default value:

[source,json]
----
"OutgoingTraffic"
----

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `expirationTime`

Type: `time`

If set the policy will be automatically deleted after the given time.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `object`

Type: `[][]string`

Object of the policy.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subject`

Type: `[][]string`

Subject of the policy.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.

=== NetworkAccessPolicy

Allows you to define network policies to allow or prevent processing
units identified by their tags to talk to other processing units or
external networks (also identified by their tags).

==== Example

[source,json]
----
{
  "action": "Allow",
  "applyPolicyMode": "Bidirectional",
  "disabled": false,
  "encryptionEnabled": false,
  "fallback": false,
  "logsEnabled": false,
  "name": "the name",
  "negateObject": false,
  "negateSubject": false,
  "observationEnabled": false,
  "observedTrafficAction": "Continue",
  "propagate": false,
  "protected": false
}
----

==== Relations

===== `GET /networkaccesspolicies`

Retrieves the list of network policies.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.
* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `POST /networkaccesspolicies`

Creates a new network policy.

===== `DELETE /networkaccesspolicies/:id`

Deletes the policy with the given ID.

Parameters:

* `q` (`string`): Filtering query. Consequent `q` parameters will form
an or.

===== `GET /networkaccesspolicies/:id`

Retrieves the policy with the given ID.

Parameters:

* `propagated` (`boolean`): Also retrieve the objects that propagate
down.

===== `PUT /networkaccesspolicies/:id`

Updates the policy with the given ID.

===== `GET /networkaccesspolicies/:id/externalnetworks`

Returns the list of external networks affected by a network policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

===== `GET /networkaccesspolicies/:id/processingunits`

Returns the list of processing units affected by a network policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

===== `GET /networkaccesspolicies/:id/services`

Returns the list of services affected by a network policy.

Parameters:

* `mode` (`enum(subject | object)`): Matching mode.

==== Attributes

===== `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

Identifier of the object.

===== `action`

Type: `enum(Allow | Reject | Continue)`

Defines the action to apply to a flow.

* `Allow`: allows the defined traffic.
* `Reject`: rejects the defined traffic; useful in conjunction with an
allow all policy.
* `Continue`: neither allows or rejects the traffic; useful for applying
another property to the traffic.

Default value:

[source,json]
----
"Allow"
----

===== `activeDuration` [`format=^[0-9]+[smh]$`]

Type: `string`

Defines for how long the policy will be active according to the
`activeSchedule`.

===== `activeSchedule`

Type: `string`

Defines when the policy should be active using the cron notation. The
policy will be active for the given `activeDuration`.

===== `annotations`

Type: `map[string][]string`

Stores additional information about an entity.

===== `applyPolicyMode`

Type: `enum(OutgoingTraffic | IncomingTraffic | Bidirectional)`

Sets three different types of policies. `IncomingTraffic`: applies the
policy to all processing units that match the `object` and allows them
to _accept_ connections from processing units or external networks that
match the `subject`. `OutgoingTraffic`: applies the policy to all
processing units that match the `subject` and allows them to _initiate_
connections with processing units or external networks that match the
`object`. `Bidirectional` (default): applies the policy to all
processing units that match the `object` and allows them to _accept_
connections from processing units that match the `subject`. Also applies
the policy to all processing units that match the `subject` and allows
them to _initiate_ connections with processing units that match the
`object`.

Default value:

[source,json]
----
"Bidirectional"
----

===== `associatedTags`

Type: `[]string`

List of tags attached to an entity.

===== `createTime` [`autogenerated`,`read_only`]

Type: `time`

Creation date of the object.

===== `description` [`max_length=1024`]

Type: `string`

Description of the object.

===== `disabled`

Type: `boolean`

Defines if the property is disabled.

===== `encryptionEnabled`

_This attribute is deprecated_.

Type: `boolean`

Defines if the flow has to be encrypted. This property is deprecated and
have no incidence.

===== `expirationTime`

Type: `time`

If set the policy will be automatically deleted after the given time.

===== `fallback`

Type: `boolean`

Indicates that this is fallback policy. It will only be applied if no
other policies have been resolved. If the policy is also propagated it
will become a fallback for children namespaces.

===== `logsEnabled`

Type: `boolean`

If `true`, the relevant flows are logged and available from Segment
Console. Under some advanced scenarios you may wish to set this to
`false`, such as to save space or improve performance.

===== `metadata` [`creation_only`]

Type: `[]string`

Contains tags that can only be set during creation, must all start with
the `@' prefix, and should only be used by external systems.

===== `name` [`required`,`max_length=256`]

Type: `string`

Name of the entity.

===== `namespace` [`autogenerated`,`read_only`]

Type: `string`

Namespace tag attached to an entity.

===== `negateObject`

Type: `boolean`

Setting this to `true` will invert the object to find what is not
matching.

===== `negateSubject`

Type: `boolean`

Setting this to `true` will invert the subject to find what is not
matching.

===== `normalizedTags` [`autogenerated`,`read_only`]

Type: `[]string`

Contains the list of normalized tags of the entities.

===== `object`

Type: `[][]string`

A tag or tag expression identifying the object of the policy.

===== `observationEnabled`

Type: `boolean`

If set to `true`, the flow will be in observation mode.

===== `observedTrafficAction`

Type: `enum(Apply | Continue)`

If `observationEnabled` is set to `true`, this defines the final action
taken on the packets: `Apply` or `Continue` (default).

Default value:

[source,json]
----
"Continue"
----

===== `ports`

Type: `[]string`

Represents the ports and protocols this policy applies to.

===== `propagate`

Type: `boolean`

Propagates the policy to all of its children.

===== `protected`

Type: `boolean`

Defines if the object is protected.

===== `subject`

Type: `[][]string`

A tag or tag expression identifying the subject of the policy.

===== `updateTime` [`autogenerated`,`read_only`]

Type: `time`

Last update date of the object.
